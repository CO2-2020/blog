(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{345:function(t,s,a){"use strict";a.r(s);var n=a(33),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"page-visibility-api-概念及使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#page-visibility-api-概念及使用场景"}},[t._v("#")]),t._v(" Page Visibility API 概念及使用场景")]),t._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("用户离开页面，常用的是监听以下几个方法")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("pagehide")])]),t._v(" "),a("li",[a("code",[t._v("beforeunload")])]),t._v(" "),a("li",[a("code",[t._v("unload")])])]),t._v(" "),a("p",[t._v("以下几种情况不会触发上面三个事件，因为手机系统会将一个进程转到后台然后杀死。")]),t._v(" "),a("ul",[a("li",[t._v("用户点击了一条系统通知，切换到另一个 App。")]),t._v(" "),a("li",[t._v("用户进入任务切换窗口，切换到另一个 App。")]),t._v(" "),a("li",[t._v("用户点击了 Home 按钮，切换回主屏幕。")]),t._v(" "),a("li",[t._v("操作系统自动切换到另一个 App（比如，收到一个电话）。")])]),t._v(" "),a("h3",{attrs:{id:"作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#作用"}},[t._v("#")]),t._v(" 作用")]),t._v(" "),a("p",[a("code",[t._v("Page Visibility API")]),t._v(" "),a("strong",[t._v("不管手机或桌面电脑，所有情况下，这个 API 都会监听到页面的可见性发生变化。(除了正常的页面卸载还包括页面被系统切换和系统清除浏览器进程)")])]),t._v(" "),a("h3",{attrs:{id:"使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[t._v("#")]),t._v(" 使用场景")]),t._v(" "),a("p",[t._v("这个新的 API 的意义在于，通过"),a("strong",[t._v("监听网页的可见性")]),t._v("，可以"),a("strong",[t._v("预判网页的卸载")]),t._v("，还可以用来"),a("strong",[t._v("节省资源，减缓电能的消耗")]),t._v("。比如，一旦用户不看网页，下面这些网页行为都是可以暂停的。")]),t._v(" "),a("ul",[a("li",[t._v("对服务器的轮询")]),t._v(" "),a("li",[t._v("网页动画")]),t._v(" "),a("li",[t._v("正在播放的音频或视频")])]),t._v(" "),a("h2",{attrs:{id:"document-visibilitystate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#document-visibilitystate"}},[t._v("#")]),t._v(" document.visibilityState")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("该属性返回一个字符串，表示页面当前的可见性状态，共有三个可能的值。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("hidden")]),t._v("：页面彻底不可见。")]),t._v(" "),a("li",[a("code",[t._v("visible")]),t._v("：页面至少一部分可见。")]),t._v(" "),a("li",[a("code",[t._v("prerender")]),t._v("：页面即将或正在渲染，处于不可见状态。")])]),t._v(" "),a("p",[a("code",[t._v("hidden")]),t._v(" 状态和 "),a("code",[t._v("visible")]),t._v(" 状态是所有浏览器都必须支持的。 "),a("code",[t._v("prerender")]),t._v(' 状态只在支持"预渲染"的浏览器上才会出现，\n只要页面可见，哪怕只露出一个角， '),a("code",[t._v("document.visibilityState")]),t._v(" 属性就返回 "),a("code",[t._v("visible")]),t._v(" 。")]),t._v(" "),a("p",[t._v("只有以下四种情况，才会返回 "),a("code",[t._v("hidden")]),t._v(" 。")]),t._v(" "),a("ul",[a("li",[t._v("浏览器最小化。")]),t._v(" "),a("li",[t._v("浏览器没有最小化，但是当前页面切换成了背景页。")]),t._v(" "),a("li",[t._v("浏览器将要卸载（unload）页面。")]),t._v(" "),a("li",[t._v("操作系统触发锁屏屏幕。")])]),t._v(" "),a("p",[t._v("注意， "),a("code",[t._v("document.visibilityState")]),t._v(" 属性只针对顶层窗口，内嵌的页面的 "),a("code",[t._v("document.visibilityState")]),t._v(" 属性由顶层窗口决定。使用 CSS 属性隐藏页面（比如display: none;），并不会影响内嵌页面的可见性。")]),t._v(" "),a("h2",{attrs:{id:"document-hidden"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#document-hidden"}},[t._v("#")]),t._v(" document.hidden")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("该属性只读，返回一个布尔值，表示当前页面是否可见。\n当 "),a("code",[t._v("document.visibilityState")]),t._v(" 属性返回 "),a("code",[t._v("visible")]),t._v(" 时， "),a("code",[t._v("document.hidden")]),t._v(" 属性返回 "),a("code",[t._v("false")]),t._v(" 其他情况下，都返回 "),a("code",[t._v("true")])]),t._v(" "),a("h2",{attrs:{id:"visibilitychange-事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#visibilitychange-事件"}},[t._v("#")]),t._v(" visibilitychange 事件")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("只要 "),a("code",[t._v("document.visibilityState")]),t._v(" 属性发生变化，就会触发 "),a("code",[t._v("visibilitychange")]),t._v(" 事件。因此，可以通过监听这个事件（通过 "),a("code",[t._v("document.addEventListener()")]),t._v(" 方法或 "),a("code",[t._v("document.onvisibilitychange")]),t._v(" 属性），跟踪页面可见性的变化。")]),t._v(" "),a("p",[a("strong",[t._v("Page Visibility API 的最基本用法，可以监听可见性变化。")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'visibilitychange'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用户离开了当前页面")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("visibilityState "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hidden'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'页面不可见'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用户打开或回到页面")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("visibilityState "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'visible'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'页面可见'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("p",[a("strong",[t._v("下面是另一个例子，一旦页面不可见，就暂停视频播放")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" vidElem "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'video-demo'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'visibilitychange'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" startStopVideo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("startStopVideo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("visibilityState "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hidden'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    vidElem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pause")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("visibilityState "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'visible'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    vidElem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("play")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("h2",{attrs:{id:"页面卸载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#页面卸载"}},[t._v("#")]),t._v(" 页面卸载")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("页面卸载可以分成三种情况。")]),t._v(" "),a("ul",[a("li",[t._v("页面可见时，用户关闭 Tab 页或浏览器窗口。")]),t._v(" "),a("li",[t._v("页面可见时，用户在当前窗口前往另一个页面。")]),t._v(" "),a("li",[t._v("页面不可见时，用户或系统关闭浏览器窗口。")])]),t._v(" "),a("p",[t._v("这三种情况，都会触发 "),a("code",[t._v("visibilitychange")]),t._v(" 事件。前两种情况，该事件在"),a("strong",[t._v("用户离开页面")]),t._v("时触发；最后一种情况，该事件在页面"),a("strong",[t._v("从可见状态变为不可见状态")]),t._v("时触发。")]),t._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("由此可见， "),a("code",[t._v("visibilitychange")]),t._v(" 事件比 "),a("code",[t._v("pagehide")]),t._v(" 、 "),a("code",[t._v("beforeunload")]),t._v(" 、 "),a("code",[t._v("unload")]),t._v(" 事件更可靠，所有情况下都会触发（从 "),a("code",[t._v("visible")]),t._v(" 变为 "),a("code",[t._v("hidden")]),t._v(" ）。因此，"),a("strong",[t._v("可以只监听这个事件，运行页面卸载时需要运行的代码，不用监听后面那三个事件。")]),t._v("\n**\n参考\n"),a("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2018/10/page_visibility_api.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Page Visibility API 教程"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);